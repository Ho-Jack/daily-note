# Redis

**基本特性：**
**基于键值对、读写速度快、数据结构丰富、简单稳定、支持持久化、支持事务（原子性）、主从复制、高可用与分布式。**

- key-value 存储系统，是跨平台的非关系型数据库
- Redis 是一个开源的使用 ANSI C 语言编写、遵守 BSD 协议、支持网络、可基于内存、分布式、可选持久性的键值对(Key-Value)存储数据库，并提供多种语言的 API。
- Redis是基于C语言实现的，一般来说C语言距离操作系统更近，执行速度相对更快
- Redis 通常被称为数据结构服务器，因为值（value）可以是字符串(String)、哈希(Hash)、列表(list)、集合(sets)和有序集合(sorted sets)等类型。
- Redis采用了单线程架构，避免了不必要的上下文切换和竞争条件，线程安全
- 使用多路 I/O 复用模型，非阻塞 IO；

## 优势:

- 高性能： 访问内存速度远远快于读取用硬盘,  访问数据库中的某些数据,是从硬盘上读取的。操作缓存就是直接操作内存，所以**速度相当快**。
- 高并发：直接操作缓存能够承受的请求是远远大于直接访问数据库的
  

## 使用场景

#### 作为缓存

-  优势: 减少数据库的访问频率。 提高数据的访问率。

- 什么数据合适作为缓存: 

  1. 热点数据 

  2. 修改频率比较低
  3. 安全系数低的

#### 数据共享分布式

String 类型，因为 Redis 是分布式的独立服务，可以在多个应用之间共享

#### 分布式锁

> 利用redis单线程的的特性,实现分布式锁

- `EX`：设置键的过期时间（单位为秒）
- `PX`：设置键的过期时间（单位为毫秒）
- `NX` ：只在键不存在时，才对键进行设置操作。 `SET key value NX` 效果等同于 `SETNX key value` 。
- `XX` ：只在键已经存在时，才对键进行设置操作。

- setnx

  > 有在 key 不存在时设置 key 的值。返回 1和0

- Expire 

  > 设置过期时间 单位second

```java

public static boolean getLock(String key) {
    Long flag = jedis.setnx(key, "1");
    if (flag == 1) {
        jedis.expire(key, 10);
    }
    return flag == 1;
}
 
public static void releaseLock(String key) {
    jedis.del(key);
}
```



 ####  消息队列

> 有序

三种方案:

- PUB/SUB，订阅/发布模式
- 基于List的 LPUSH+BRPOP 的实现
- 基于Sorted-Set的实现
- Redis5.0的Stream类型

要求: 

- 消息保序：对应消息需要有序消费的场景
- 处理重复消息：如网络抖动引起的同一条消息多次被投递到队列的场景
- 保证消息可靠性：消息从队列取出，此时客户端宕机，消息未正常消费的场景

#### 计数器

> int类型，incr方法

- incr

  > Incr 命令将 key 中储存的数字值增一。
  >
  > 如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR 操作

例如：文章的阅读量、微博点赞数、允许一定的延迟，先写入Redis再定时同步到数据库

#### 限流

> int类型，incr方法

以访问者的ip和其他信息作为key，访问一次增加一次计数，超过次数则返回false





## Redis支持的数据类型

Redis支持五种数据类型：

- string（字符串）

- hash（哈希）

- list（列表）

- set（集合）

- zset(sorted set：有序集合)

### String

字符串类型是Redis最基础的数据结构（key-value 类型），其它的几种数据结构都是在字符串类型基础上构建的，字符串的值可以是：字符串、数字、二进制，但其值最大不能超过512M。

- 特性：二进制安全的，计算字符串长度高效、追加字符串高效

使用场景： 缓存、计数器、对象存储缓存（共享session）、限速



### **Hash**

Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象。

`value={{field1,value1},{field2,value2}…}`

应用场景： 用户信息缓存



### **List**

Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部或者尾部，也可以获取指定范围指定下标的元素等。一个列表最多可以包含 232 - 1 个元素 (4294967295， 每个列表超过40亿个元素)。

两个特点：

- 有序, 可以通过索引下标获取某个元素霍某个某个范围内的元素列表
- 可重复

使用场景： 消息队列、栈、文章列表等。 时间线

### **Set**

Redis的Set是String类型的无序集合，我们不能通过索引获取元素。集合成员是唯一的，这就意味着集合中不能出现重复的数据。Redis中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。

- 无序
- 不重复

应用场景： 标签（tag）



### Zset

在有序集合中保留了不能有重复成员的特性，但其中的成员是可以排序的，每一个元素都会关联一个double类型的分数（score）作为排序依据，score相同时按字典顺序排序。redis正是通过分数来为集合中的成员进行从小到大的排序。

- 有序
- 不重复

应用场景： 排行榜系统，成绩单，工资表