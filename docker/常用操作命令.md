- image: 镜像,是一个只读模版，用来创建容器
- container:   容器是一个可运行的镜像实例。(类比： 一个完整操作系统)
- Dockerfile: 镜像构建的模版，描述镜像构建的步骤。（类比：“package.json”）

关系：**通过Dockerfile构建出镜像，然后通过镜像来创建容器，程序就跑在容器中**。并且一个镜像可以随意创建N个容器，各个容器间相互隔离

### 步骤：

1. 写一个 Dockerfile
2. 使用`docker image build`来将`Dockerfile`打包成镜像
3. 使用`docker container create`来根据镜像创建一个容器
4. 使用`docker container start`来启动一个创建好的容器

### 镜像操作命令

```sh
# 搜索镜像
docker search [images_name:tag]

# 下载镜像（：指定版本）
docker pull [images_name:tag]

# 查看本地下载的镜像
docker images

# 自己构建镜像
# 根据dockerfile的路径或者url构建镜像
 docker build [OPTIONS] PATH|URL|-

# 查看镜像的构建历史
docker history [images_name]

# 删除镜像
# 需要先删除以此镜像为基础的容器
 docker rmi [images_name]
```

### 容器操作命令

```shell
# 查看运行中的容器
# 可以查看容器ID、基础镜像、容器名称、运行状态、端口映射等
docker ps

# 查看所有容器：包括停止的
docker ps -a

# 查看容器的信息
# 例如端口号的映射、目录挂载
docker inspect [images_name/images_id]

# 启动和停止容器
docker start/stop [container_name/container_id]

#  重启容器
#  使用场景实例：
#  在加入新的npm包依赖需要重新编译的时候使用重启运行编译
#  nginx容器的配置更新后需要重启生效
docker restart [container_name/container_id]

# 进入容器
# ps:有些容器没有bash,需要改成/bin/sh，例如mysq、mongodb的
# 退出人容器输入exit 回车键
docker exec -it [container_name/container_id] /bin/bash

# 删除容器
# 在容器停止的状态才能删
docker rm [container_name/container_id]

# 容器主机文件拷
# 将容器文件拷贝到主机
docker cp [container_id/container_name] : [文件目录] [主机目录]

# 将主机的目录拷贝到容器
docker cp [主机目录] [container_id/container_name] : [文件目录]

```



### Docker使用实例



#### docker 安装redis容器

1. 拉取redis镜像

   ```shell
   docker pull redis
   ```

2. 根据redis镜像生成本地容器

   > 可选:将redis的配置和数据映射到本地
   >
   > 需要本地`redis.config`配置文件与docker的redis进映射

   ```
   docker run -d --name  local_redis  -p 6379:6379 -v D:/docker/redis:/etc/redis -v D:/docker/redis/data/:/data redis:latest redis-server /etc/redis/redis.conf --appendonly yes
   ```

   `-d` 后台运行

   `-p 6379:6379` 宿主机和容器的端口映射

   `--restart always`  自动启动

   `--privileged=true` container内的root拥有真正的root权限

   `-v $PWD/conf/redis.conf:/etc/redis/redis.conf`  挂载配置文件

   `-v $PWD/data:/data`  数据目录，冒号左边是宿主机目录，冒号右边是容器内部路径

   `--requirepass` 密码，也可通过`redis.conf`配置

   `--appendonly` 持久化，也可通过`redis.conf`配置

   `redis-server /etc/redis/redis.conf `：以配置文件的形式启动redis

3. 查看容器是否启动成功

   ```
   docker ps
   ```

4. 打开redis管理工具,连接数据库,添加对应的端口,查看是否成功



